# innovation & Cooperation : 부릉부름
<div align="center">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/d41fedf3-3b9e-4a81-b303-ea93d3c4051e" width="300px">
</div>

## 📃 프로젝트 소개
- #### 주제 : 지역기반 C2C 심부름 서비스
  
    - 본인만의 사정이 있거나 단순 귀찮음으로 인해 금액을 지불해서라도 자신이 해야할 일을 대행해주기를 바라는 사람
      ###### ex) 물건을 잃어버린 자, 급하게 해야할 일이 생겼으나 시간적 여유가 되지 않는 자, 자신의 귀찮은 일을 대신해주길 바라는 1인 가구 등
      <br>
      
    - 근로할 능력이 충분하고 금전을 보상받아 뭔가를 대행할 의사가 있는 사람
      ###### ex) 학업에 치중해야 해서 규칙적인 시간에 아르바이트를 하기 힘든 상황에 놓인 대학생, 개인사정으로 인해 일을 쉬고 있지만 용돈벌이가 필요한 이용자 등
      <br>
    - `위 두 부류에 해당하는 사람들을 본 서비스의 이용자로 만들어 서로 연결시켜주는 서비스`
<br>

## 📅 프로젝트 기간
- ２３. １１. ２８ 　~ 　２３. １２. １３
<br>

## 🛠 사용 기술

<table>
    <tr>
        <th>구분</th>
        <th>내용</th>
    </tr>
    <tr>
        <td>Back-end</td>
        <td>
            <img src="https://img.shields.io/badge/Java-007396?style=for-the-badge&logo=java&logoColor=white"/> 
            <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
            <img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=Python&logoColor=white"/>
            <img src="https://img.shields.io/badge/MyBatis-111111?style=for-the-badge&logo=MyBatis&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>Front-end</td>
        <td>
            <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white">
            <img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white">
            <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
        </td>
    </tr>
    <tr>
        <td>Data & Server</td>
        <td>
            <img src="https://img.shields.io/badge/oracle-F80000?style=for-the-badge&logo=oracle&logoColor=white">
            <img src="https://img.shields.io/badge/apache tomcat-F8DC75?style=for-the-badge&logo=apachetomcat&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>Library & API</td>
        <td>
            <img src="https://img.shields.io/badge/jquery-0769AD?style=for-the-badge&logo=jquery&logoColor=white">
            <img src="https://img.shields.io/badge/Kakao Map API-007CE2?style=for-the-badge&logo=KaKao Map Api&logoColor=white">
            <img src="https://img.shields.io/badge/I'mport API-dddddd?style=for-the-badge&logo=&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>IDT</td>
        <td>
            <img src="https://img.shields.io/badge/eclipse-2C2255?style=for-the-badge&logo=eclipseide&logoColor=white">
            <img src="https://img.shields.io/badge/Jupyter-F37626?style=for-the-badge&logo=Jupyter&logoColor=white"/>
            <img src="https://img.shields.io/badge/SQL Developer-777777?style=for-the-badge&logo=&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>Etc.</td>
        <td>
            <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
            <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
        </td>
    </tr>
    
</table>
<br>

## 🕸 유스케이스 다이어그램
<img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/cd302cc5-b708-4209-a9bd-2ec798b0d13c" width="800px"/>
<br>
<br>

## 🗃 ERD
![부릉부름 테이블](https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/034f07aa-ad79-47de-9b59-27b30634d601)
<br>
<br>
<br>
<br>

## 🔌 메뉴 구성 및 흐름도
![메뉴 구성 및 흐름도](https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/748cc901-7447-4c54-a11e-e271d6bc7364)
<br>
<br>

## ✒ 구현 전 화면설계
<br>
<details>
<summary><b>화면설계 펼치기</b></summary>
<div markdown="1">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/de03d730-1fea-4b53-8c6b-7b69429c70e2">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/1494f6f7-c471-4c86-a66f-b6999cf995ce">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/6bbcef91-ae71-4e04-9d81-704c7259ebbf">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/605e1e9b-7ab3-42f9-bbd1-07e022531848">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/69503c4b-ea70-42d1-9c9e-da31a9a1ca14">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/324d3ee9-4df2-4684-a713-a4a15eecd3d1">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/60e936c0-780c-4349-9782-67248a4aa422">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/fbda0e5e-3829-47a0-adf3-b13df99365c5">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/219b8770-f94d-4fbf-a423-13ec412fedfd">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/56e1a0bf-4cf6-4702-817b-f5df2a1edf48">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/f3a641f5-6e00-43bc-b8cd-1e27af97d059">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/5524c49f-d543-4b17-a0fa-de9d1e315713">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/8d3d9017-c002-42ba-81b6-5c82cad4a16f">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/e4a2b01b-6ed3-49ec-9528-f8def378dffa">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/9f4a2279-6265-499f-ad8f-5eaae0a6b230">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/2ecff5ea-66ec-4908-b4aa-1ca5d3ff3ea9">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/3b500dcb-92ca-4aca-8e37-b5c84487834f">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/f0e9b695-d406-40ec-a2e8-c6a99cceb15b">
    <img src="https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/08174598-9c50-4013-9122-e179ddff46d2">
</div>
</details>
<br>

## 📌 주요 기능

- 본 프로젝트에서 가장 우선적으로 생각했던 요소는 사용자로부터 데이터를 입력받고, 입력받은 데이터를 가공해서 사용자들에게 출력해주는 것입니다.
    - 사용자의 심부름 요청
    - 사용자의 심부름 지원
    - 심부름 목록 출력
    - 심부름 상세정보 출력
    - 조건 만족시 요청자와 지원자 연결
    - 조건 만족시 후기 작성
    - 사용자가 요청, 지원한 심부름들을 목록화하여 출력
    - 사용자가 언제 충전을 했으며 어떤 명목으로 결제가 진행됐는지 확인할 수 있는 충전내역, 결제내역 출력
    - 사용자의 정보 출력
   
- 사용자들이 서로 소통이 가능한 환경을 제공하기 위해 웹소켓을 활용하여 일대일 채팅을 제공합니다.

- 그 외 회원가입 및 로그인, 회원 정보 변경, 충전 등.


</br>

## 📽 시연 영상
https://github.com/2021-SMHRD-KDT-AI-15/BB/assets/145624456/24c71ad8-3422-430f-9780-fb98c2f400f4


## 5. 핵심 트러블 슈팅
### 5.1. 컨텐츠 필터와 페이징 처리 문제
- 저는 이 서비스가 페이스북이나 인스타그램 처럼 가볍게, 자주 사용되길 바라는 마음으로 개발했습니다.  
때문에 페이징 처리도 무한 스크롤을 적용했습니다.

- 하지만 [무한스크롤, 페이징 혹은 “더보기” 버튼? 어떤 걸 써야할까](https://cyberx.tistory.com/82) 라는 글을 읽고 무한 스크롤의 단점들을 알게 되었고,  
다양한 기준(카테고리, 사용자, 등록일, 인기도)의 게시물 필터 기능을 넣어서 이를 보완하고자 했습니다.

- 그런데 게시물이 필터링 된 상태에서 무한 스크롤이 동작하면,  
필터링 된 게시물들만 DB에 요청해야 하기 때문에 아래의 **기존 코드** 처럼 각 필터별로 다른 Query를 날려야 했습니다.

<details>
<summary><b>기존 코드</b></summary>
<div markdown="1">

~~~java
/**
 * 게시물 Top10 (기준: 댓글 수 + 좋아요 수)
 * @return 인기순 상위 10개 게시물
 */
public Page<PostResponseDto> listTopTen() {

    PageRequest pageRequest = PageRequest.of(0, 10, Sort.Direction.DESC, "rankPoint", "likeCnt");
    return postRepository.findAll(pageRequest).map(PostResponseDto::new);
}

/**
 * 게시물 필터 (Tag Name)
 * @param tagName 게시물 박스에서 클릭한 태그 이름
 * @param pageable 페이징 처리를 위한 객체
 * @return 해당 태그가 포함된 게시물 목록
 */
public Page<PostResponseDto> listFilteredByTagName(String tagName, Pageable pageable) {

    return postRepository.findAllByTagName(tagName, pageable).map(PostResponseDto::new);
}

// ... 게시물 필터 (Member) 생략 

/**
 * 게시물 필터 (Date)
 * @param createdDate 게시물 박스에서 클릭한 날짜
 * @return 해당 날짜에 등록된 게시물 목록
 */
public List<PostResponseDto> listFilteredByDate(String createdDate) {

    // 등록일 00시부터 24시까지
    LocalDateTime start = LocalDateTime.of(LocalDate.parse(createdDate), LocalTime.MIN);
    LocalDateTime end = LocalDateTime.of(LocalDate.parse(createdDate), LocalTime.MAX);

    return postRepository
                    .findAllByCreatedAtBetween(start, end)
                    .stream()
                    .map(PostResponseDto::new)
                    .collect(Collectors.toList());
    }
~~~

</div>
</details>

- 이 때 카테고리(tag)로 게시물을 필터링 하는 경우,  
각 게시물은 최대 3개까지의 카테고리(tag)를 가질 수 있어 해당 카테고리를 포함하는 모든 게시물을 질의해야 했기 때문에  
- 아래 **개선된 코드**와 같이 QueryDSL을 사용하여 다소 복잡한 Query를 작성하면서도 페이징 처리를 할 수 있었습니다.

<details>
<summary><b>개선된 코드</b></summary>
<div markdown="1">

~~~java
/**
 * 게시물 필터 (Tag Name)
 */
@Override
public Page<Post> findAllByTagName(String tagName, Pageable pageable) {

    QueryResults<Post> results = queryFactory
            .selectFrom(post)
            .innerJoin(postTag)
                .on(post.idx.eq(postTag.post.idx))
            .innerJoin(tag)
                .on(tag.idx.eq(postTag.tag.idx))
            .where(tag.name.eq(tagName))
            .orderBy(post.idx.desc())
                .limit(pageable.getPageSize())
                .offset(pageable.getOffset())
            .fetchResults();

    return new PageImpl<>(results.getResults(), pageable, results.getTotal());
}
~~~

</div>
</details>

</br>

## 6. 그 외 트러블 슈팅
<details>
<summary>npm run dev 실행 오류</summary>
<div markdown="1">

- Webpack-dev-server 버전을 3.0.0으로 다운그레이드로 해결
- `$ npm install —save-dev webpack-dev-server@3.0.0`

</div>
</details>

<details>
<summary>vue-devtools 크롬익스텐션 인식 오류 문제</summary>
<div markdown="1">
  
  - main.js 파일에 `Vue.config.devtools = true` 추가로 해결
  - [https://github.com/vuejs/vue-devtools/issues/190](https://github.com/vuejs/vue-devtools/issues/190)
  
</div>
</details>

<details>
<summary>ElementUI input 박스에서 `v-on:keyup.enter="메소드명"`이 정상 작동 안하는 문제</summary>
<div markdown="1">
  
  - `v-on:keyup.enter.native=""` 와 같이 .native 추가로 해결
  
</div>
</details>

<details>
<summary> Post 목록 출력시에 Member 객체 출력 에러 </summary>
<div markdown="1">
  
  - 에러 메세지(500에러)
    - No serializer found for class org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationConfig.SerializationFeature.FAIL_ON_EMPTY_BEANS)
  - 해결
    - Post 엔티티에 @ManyToOne 연관관계 매핑을 LAZY 옵션에서 기본(EAGER)옵션으로 수정
  
</div>
</details>
    
<details>
<summary> 프로젝트를 git init으로 생성 후 발생하는 npm run dev/build 오류 문제 </summary>
<div markdown="1">
  
  ```jsx
    $ npm run dev
    npm ERR! path C:\Users\integer\IdeaProjects\pilot\package.json
    npm ERR! code ENOENT
    npm ERR! errno -4058
    npm ERR! syscall open
    npm ERR! enoent ENOENT: no such file or directory, open 'C:\Users\integer\IdeaProjects\pilot\package.json'
    npm ERR! enoent This is related to npm not being able to find a file.
    npm ERR! enoent

    npm ERR! A complete log of this run can be found in:
    npm ERR!     C:\Users\integer\AppData\Roaming\npm-cache\_logs\2019-02-25T01_23_19_131Z-debug.log
  ```
  
  - 단순히 npm run dev/build 명령을 입력한 경로가 문제였다.
   
</div>
</details>    

<details>
<summary> 태그 선택후 등록하기 누를 때 `object references an unsaved transient instance - save the transient instance before flushing` 오류</summary>
<div markdown="1">
  
  - Post 엔티티의 @ManyToMany에 영속성 전이(cascade=CascadeType.ALL) 추가
    - JPA에서 Entity를 저장할 때 연관된 모든 Entity는 영속상태여야 한다.
    - CascadeType.PERSIST 옵션으로 부모와 자식 Enitity를 한 번에 영속화할 수 있다.
    - 참고
        - [https://stackoverflow.com/questions/2302802/object-references-an-unsaved-transient-instance-save-the-transient-instance-be/10680218](https://stackoverflow.com/questions/2302802/object-references-an-unsaved-transient-instance-save-the-transient-instance-be/10680218)
   
</div>
</details>    

<details>
<summary> JSON: Infinite recursion (StackOverflowError)</summary>
<div markdown="1">
  
  - @JsonIgnoreProperties 사용으로 해결
    - 참고
        - [http://springquay.blogspot.com/2016/01/new-approach-to-solve-json-recursive.html](http://springquay.blogspot.com/2016/01/new-approach-to-solve-json-recursive.html)
        - [https://stackoverflow.com/questions/3325387/infinite-recursion-with-jackson-json-and-hibernate-jpa-issue](https://stackoverflow.com/questions/3325387/infinite-recursion-with-jackson-json-and-hibernate-jpa-issue)
        
</div>
</details>  
    
<details>
<summary> H2 접속문제</summary>
<div markdown="1">
  
  - H2의 JDBC URL이 jdbc:h2:~/test 으로 되어있으면 jdbc:h2:mem:testdb 으로 변경해서 접속해야 한다.
        
</div>
</details> 
    
<details>
<summary> 컨텐츠수정 모달창에서 태그 셀렉트박스 드랍다운이 뒤쪽에 보이는 문제</summary>
<div markdown="1">
  
   - ElementUI의 Global Config에 옵션 추가하면 해결
     - main.js 파일에 `Vue.us(ElementUI, { zIndex: 9999 });` 옵션 추가(9999 이하면 안됌)
   - 참고
     - [https://element.eleme.io/#/en-US/component/quickstart#global-config](https://element.eleme.io/#/en-US/component/quickstart#global-config)
        
</div>
</details> 

<details>
<summary> HTTP delete Request시 개발자도구의 XHR(XMLHttpRequest )에서 delete요청이 2번씩 찍히는 이유</summary>
<div markdown="1">
  
  - When you try to send a XMLHttpRequest to a different domain than the page is hosted, you are violating the same-origin policy. However, this situation became somewhat common, many technics are introduced. CORS is one of them.

        In short, server that you are sending the DELETE request allows cross domain requests. In the process, there should be a **preflight** call and that is the **HTTP OPTION** call.

        So, you are having two responses for the **OPTION** and **DELETE** call.

        see [MDN page for CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS).

    - 출처 : [https://stackoverflow.com/questions/35808655/why-do-i-get-back-2-responses-of-200-and-204-when-using-an-ajax-call-to-delete-o](https://stackoverflow.com/questions/35808655/why-do-i-get-back-2-responses-of-200-and-204-when-using-an-ajax-call-to-delete-o)
        
</div>
</details> 

<details>
<summary> 이미지 파싱 시 og:image 경로가 달라서 제대로 파싱이 안되는 경우</summary>
<div markdown="1">
  
  - UserAgent 설정으로 해결
        - [https://www.javacodeexamples.com/jsoup-set-user-agent-example/760](https://www.javacodeexamples.com/jsoup-set-user-agent-example/760)
        - [http://www.useragentstring.com/](http://www.useragentstring.com/)
        
</div>
</details> 
    
<details>
<summary> 구글 로그인으로 로그인한 사용자의 정보를 가져오는 방법이 스프링 2.0대 버전에서 달라진 것</summary>
<div markdown="1">
  
  - 1.5대 버전에서는 Controller의 인자로 Principal을 넘기면 principal.getName(0에서 바로 꺼내서 쓸 수 있었는데, 2.0대 버전에서는 principal.getName()의 경우 principal 객체.toString()을 반환한다.
    - 1.5대 버전에서 principal을 사용하는 경우
    - 아래와 같이 사용했다면,

    ```jsx
    @RequestMapping("/sso/user")
    @SuppressWarnings("unchecked")
    public Map<String, String> user(Principal principal) {
        if (principal != null) {
            OAuth2Authentication oAuth2Authentication = (OAuth2Authentication) principal;
            Authentication authentication = oAuth2Authentication.getUserAuthentication();
            Map<String, String> details = new LinkedHashMap<>();
            details = (Map<String, String>) authentication.getDetails();
            logger.info("details = " + details);  // id, email, name, link etc.
            Map<String, String> map = new LinkedHashMap<>();
            map.put("email", details.get("email"));
            return map;
        }
        return null;
    }
    ```

    - 2.0대 버전에서는
    - 아래와 같이 principal 객체의 내용을 꺼내 쓸 수 있다.

    ```jsx
    UsernamePasswordAuthenticationToken token =
                    (UsernamePasswordAuthenticationToken) SecurityContextHolder
                            .getContext().getAuthentication();
            Map<String, Object> map = (Map<String, Object>) token.getPrincipal();

            String email = String.valueOf(map.get("email"));
            post.setMember(memberRepository.findByEmail(email));
    ```
        
</div>
</details> 
    
<details>
<summary> 랭킹 동점자 처리 문제</summary>
<div markdown="1">
  
  - PageRequest의 Sort부분에서 properties를 "rankPoint"를 주고 "likeCnt"를 줘서 댓글수보다 좋아요수가 우선순위 갖도록 설정.
  - 좋아요 수도 똑같다면..........
        
</div>
</details> 
    
</br>

## 6. 회고 / 느낀점 / 팀원소개 /
>프로젝트 개발 회고 글: https://zuminternet.github.io/ZUM-Pilot-integer/
